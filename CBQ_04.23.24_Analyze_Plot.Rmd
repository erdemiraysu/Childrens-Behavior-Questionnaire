---
title: "CBQ_04.23.24_Analyze_Plot"
output: html_document
date: "2024-04-29"
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(gridExtra) # for multiple bar graphs in a grid
```

# LOAD DATA
```{r}
# Load DataSet: 
CBQ_scored <- read.csv(file = '/Users/aysuerdemir/Desktop/CBQ_EDA/CBQ_scored.csv') %>%
  select(-X)# Remove the added X variable after reading it back into R:
head(CBQ_scored)

```

# AGE, GENDER COUNT SUMMARY
```{r}
# Give Age, Gender and Count Summary Statistics for each Group:
CBQ_age_gender_summary <- 
  CBQ_scored %>%
  group_by(talkergroup) %>%
summarise(
    age = mean(age, na.rm = TRUE),
    min_age = min(age, na.rm = TRUE),
    max_age = max(age, na.rm = TRUE),
    male_gender_count = sum(gender, na.rm = TRUE),  # because male = 1, female = 0
    SD_age = sd(gender, na.rm = TRUE),
    Count_kids = n_distinct(subject)
    )
```

# CREATE TWO HISTOGRAMS FOR AGE DISTRIBUTION IN CWS AND CWNS
```{r}

# Create a new plot
par(mfrow=c(1,2))  # This sets up a 1x2 grid for side-by-side histograms
# Histogram for talkergroup == 1
hist(CBQ_scored$age[CBQ_scored$talkergroup == 0], 
     main = "Histogram for CWNS",
     xlab = "age in months",
     ylab = "Frequency",
     col = "blue",
     border = "black",
     xlim = c(30, 100), 
     breaks = 12)
# Histogram for talkergroup == 2
hist(CBQ_scored$age[CBQ_scored$talkergroup == 1], 
     main = "Histogram for CWS",
     xlab = "age in months",
     ylab = "Frequency",
     col = "red",  # Use a different color for the second group
     border = "black",
     xlim = c(30, 100), 
     breaks = 12)
# Reset the plotting to a single plot
par(mfrow=c(1,1))
```
# Create a summary table to be used for Bar Graphs
```{r}

# Create a summary table for each scale, representing the means and SEMs for CWS and CWNS groups:

summary_cbq <- CBQ_scored %>%
  group_by(talkergroup) %>%
  summarise(across(c(age, activity_level, anger_frustration, approach, attention_focus, attention_shift, discomfort, soothability,
                     fear, hi_intense_pleas, impulsivity, inhibit_control, lo_instense_pleas, percept_sensitive, sadness, shyness,
                     smiling_laughter, surgency, effortful_con,neg_affect),
                   list(mean = ~mean(., na.rm = TRUE), SEM = ~sd(., na.rm = TRUE)/sqrt(n()))))%>%
  rename_all(~str_remove(., "_mean")) # remove the word mean from the mean measures for ease

# Rename talkergroup factors for better visuals:
summary_cbq$talkergroup <- factor(summary_cbq$talkergroup, levels = c(0, 1), labels = c("CWNS", "CWS"))
```

# BAR PLOTS
```{r}
library(ggplot2)
library(gridExtra)

# List of variables
variables <- c("age", "activity_level", "anger_frustration", "approach", "attention_focus", "attention_shift", 
               "discomfort", "soothability", "fear", "hi_intense_pleas", "impulsivity", "inhibit_control", 
               "lo_instense_pleas", "percept_sensitive", "sadness", "shyness", "smiling_laughter", "surgency", 
               "effortful_con", "neg_affect")

# Function to create plots for each variable
create_bar_plot <- function(var, summary_cbq) {
  # Create the plot
  plot <- ggplot(summary_cbq, aes(x = factor(talkergroup), y = .data[[var]], fill = factor(talkergroup))) +
    geom_bar(stat = "identity", position = "dodge", width = 0.5) +
    geom_errorbar(aes(ymin = .data[[var]] - .data[[paste0(var, "_SEM")]], 
                      ymax = .data[[var]] + .data[[paste0(var, "_SEM")]]), 
                  width = 0.2, position = position_dodge(width = 0.7)) +
    labs(x = "", y = var) +  # Remove x-axis label
    theme_minimal() +
    theme(plot.title = element_text(size = 20), 
          axis.title = element_text(size = 16), 
          axis.text = element_text(size = 14)) +
    guides(fill = "none") +  # Remove legend

# Adjust y-axis limits for specific variables
# use `coord_cartesian(ylim = c(3, 6))` instead of `scale_y_continuous(limits = c(3, 6))` to get the blue bars plotted correctly. 
# `coord_cartesian()` only affects the visible area of the plot and does not remove any data points, 
# while `scale_y_continuous()` removes data points outside the limits from the plot altogether.

  if (var == "age") {
    plot <- plot + coord_cartesian(ylim = c(40, 60))
  } else {
    plot <- plot + coord_cartesian(ylim = c(3, 6))
  }
  
  return(plot)
}

# Create plots for each variable
plots_list <- lapply(variables, create_bar_plot, summary_cbq)

# Arrange plots in a grid
num_plots <- length(plots_list)
num_cols <- 4  # Number of columns in the grid
num_rows <- ceiling(num_plots / num_cols)

# Create a grid arrangement
cbq_plot <- grid.arrange(grobs = plots_list, ncol = num_cols)

# Save the grid arrangement
ggsave("/Users/aysuerdemir/Desktop/CBQ_EDA/cbq_plot.pdf", plot = cbq_plot, width = 20, height = 30)

```

# HISTOGRAMS
```{r}
# List of variables
variables <- c("age",  "activity_level", "anger_frustration", "approach", "attention_focus", "attention_shift", 
               "discomfort", "soothability", "fear", "hi_intense_pleas", "impulsivity", "inhibit_control", 
               "lo_instense_pleas", "percept_sensitive", "sadness", "shyness", "smiling_laughter", "surgency", 
               "effortful_con", "neg_affect")

# Set up a multi-panel plot with larger margins
par(mfrow=c(5, 4), mar=c(4, 4, 2, 1)) # Adjust the margins as needed

# Loop through each variable and create a histogram
for (variable in variables) {
  hist(CBQ_scored[[variable]], main=variable, xlab="Value", col="lightblue", border="white", breaks=20)
}

```


# T Tests for each one of these variables:
```{r}

# List of variables
variables <- c("age", "gender", "activity_level", "anger_frustration", "approach", "attention_focus", "attention_shift", 
               "discomfort", "soothability", "fear", "hi_intense_pleas", "impulsivity", "inhibit_control", 
               "lo_instense_pleas", "percept_sensitive", "sadness", "shyness", "smiling_laughter", "surgency", 
               "effortful_con", "neg_affect")

# Empty list to store results
results <- list()

# Loop through each variable
for (variable in variables) {
  # Perform t-test
  t_test_result <- t.test(CBQ_scored[CBQ_scored$talkergroup == 0, variable], 
                          CBQ_scored[CBQ_scored$talkergroup == 1, variable])
  
  # Store results
  results[[variable]] <- t_test_result
}

# Create a table of results
table_results <- sapply(results, function(x) {
  c(mean_group_0 = mean(x$estimate[1]),
    mean_group_1 = mean(x$estimate[2]),
    t_value = x$statistic,
    p_value = x$p.value)
})

# Convert the table to a data frame
table_results_df <- as.data.frame(table_results)

# Print the table
print(table_results_df)

```


